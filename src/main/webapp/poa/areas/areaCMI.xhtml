<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/templates/template.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:hf="http://highfaces.org"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="head-end">
        <style type="text/css">
            .ui-datatable .ui-datatable-header {
                text-align: right !important;
            }

            .minimizados{
                display: none;
            }            

        </style>
        <script>
            function descargar(ruta) {
                var win = window.open(ruta, '_blank');
                if (win) {
                    win.focus();
                }
            }
        </script>
        <script type="text/javascript">
            function myconfig() {
                console.log("ejemplo");
                this.yAxis = {
                    type: 'double',
                    min: 0,
                    max: 115,
                    tickAmount: 7,
                    plotBands: [{
                            from: 0.0,
                            to: 89.99,
                            color: '#FF0000'
                        },
                        {
                            from: 90.0,
                            to: 94.99,
                            color: '#ffff00'
                        },
                        {
                            from: 95.0,
                            to: 115.99,
                            color: '#66ff33'
                        }]
                };
            }
        </script>
        <!-- Inicio estilos par proceso electoral -->
        <c:if test="#{controladorEmpleado.procesoElectoralActivo}">
            <link rel="stylesheet" type="text/css" href="../../resources/css/procesoElectoral.css" media="screen" />
        </c:if>        
        <link rel="stylesheet" type="text/css" href="../../resources/css/estilosGenerales.css" media="screen" />
        <!-- Fin estilos par proceso electoral -->
    </ui:define>

    <ui:define name="title">
        Programa Anual de Trabajo
    </ui:define>

    <ui:define name="description">
        Cuadro de mando Integral
    </ui:define>

    <ui:define name="body">
        <adm:sidebar collapsed="true"/>
        <c:if test="#{controladorEmpleado.tienePOA}">

            <h:form id="frmAlineacionEstratejica" prependId="false">
                <div class="box box-primary">
                    <div id="main-buttons" class="hidden-sm hidden-xs" >
                        <p:panel header="Cuadro de Mando Integral">
                            <div class="row"> 
                                <div class="col-md-12">
                                    <p:panelGrid style="margin-top:20px">
                                        <p:row>
                                            <p:column style="font-weight: bold;">Actividades Programadas</p:column>
                                            <p:column style="font-weight: bold;">#{cuadroMandoIntegralArea.CMIArea.programadas}</p:column>
                                            <p:column rowspan="4" style="font-weight: bold;">
                                                 <hf:chart type="line" title="#{cuadroMandoIntegralArea.CMIArea.ejesRegistro}" colors="black" 
                                                          xaxisLabel="Mes" yaxisLabel="% avance" stacking="none" extender="myconfig" height="400px">
                                                    <hf:chartSerie name="Avances" type="line" value="#{cuadroMandoIntegralArea.CMIArea.avanceGraf}" var="point" point="#{cuadroMandoIntegralArea.df.format(point.avance)}"  tickLabel="#{point.mes}" dataLabel="#{point.valor}" />
                                                </hf:chart>
                                            </p:column>
                                            <p:column rowspan="3" style="font-weight: bold;">
                                                <p:chart type="metergauge" model="#{cuadroMandoIntegralArea.CMIArea.gaugeChartModel}" responsive="true" />                                            
                                            </p:column>
                                        </p:row>

                                        <p:row>
                                            <p:column style="font-weight: bold;">Actividades Realizadas</p:column>
                                            <p:column style="font-weight: bold;">#{cuadroMandoIntegralArea.CMIArea.realizadas}</p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column style="font-weight: bold;">Porcentaje Avance</p:column>
                                            <p:column style="font-weight: bold;">#{cuadroMandoIntegralArea.df.format(cuadroMandoIntegralArea.CMIArea.avance)}%</p:column>
                                        </p:row>
                                    </p:panelGrid>
                                </div>                                            
                            </div>
                        </p:panel>
                    </div>
                </div>                
                <p:spacer/>
                <div class="box box-primary">
                    <div id="main-buttons" class="hidden-sm hidden-xs" >
                        <p:panel id="pnlID" header="Cuadro de Mando Integral">
                            <div id="ejemplo" class="row">
                                <div class="col-md-12">
                                    <p:dataGrid var="cmi" value="#{cuadroMandoIntegralArea.CMIs}" columns="#{cuadroMandoIntegralArea.CMIs.size()}" layout="grid"
                                                id="cars">

                                        <f:facet name="header">
                                            Ejes rectores
                                        </f:facet>

                                        <p:panel style="text-align:center">

                                            <h:panelGrid columns="2" style="width:100%">
                                                <f:facet name="header">
                                                    <p:chart type="metergauge" model="#{cmi.gaugeChartModel}" responsive="true" />      
                                                    <hr/>
                                                     <hf:chart type="line" height="400px" title="#{cmi.ejesRegistro}" extender="myconfig" 
                                                              xaxisLabel="Mes" yaxisLabel="% avance" stacking="none" colors="black">  
                                                        <hf:chartSerie name="Avances" value="#{cmi.avanceGraf}" var="point" point="#{cuadroMandoIntegralArea.df.format(point.avance)}" tickLabel="#{point.mes}" dataLabel="#{point.valor}" />
                                                    </hf:chart>
                                                </f:facet>

                                                <h:outputText value="Actividades Programadas" style="font-weight: bold;" />
                                                <h:outputText value="#{cmi.programadas}" />

                                                <h:outputText value="Actividades Realizadas" style="font-weight: bold;"/>
                                                <h:outputText value="#{cmi.realizadas}" />

                                                <h:outputText value="Porcentaje Avance" style="font-weight: bold;"/>
                                                <h:outputText value="#{cuadroMandoIntegralArea.df.format(cmi.avance)}%" />

                                            </h:panelGrid>
                                        </p:panel>
                                    </p:dataGrid>
                                </div>
                            </div>
                        </p:panel>
                    </div>
                </div>                
            </h:form>      
            <h:form id="frm" prependId="false" >
                <div class="box box-primary">
                    <div id="main-buttons" class="hidden-sm hidden-xs" >
                        <p:panel header="Cuadro de Mando Integral">                             
                            <p:dataTable id="dtbBajas" widgetVar="dtbBajas" var="ejesRegistro" sortBy="#{ejesRegistro.ejeA.eje}"
                                         value="#{cuadroMandoIntegralArea.ejesEsLaAp}">

                                <p:headerRow>
                                    <p:column colspan="1" styleClass="eje" style="text-align: left; color: #FFFFFF;">
                                        <h:outputText value="#{ejesRegistro.ejeA.eje}.#{ejesRegistro.ejeA.nombre}" style="text-align: left"/>
                                    </p:column>
                                </p:headerRow>
                                <p:column colspan="1">
                                    <p:dataTable var="proyectos" sortBy="#{proyectos.proyectos.proyecto}" expandableRowGroups="true"
                                                 rowStyleClass="minimizados" value="#{ejesRegistro.proyectosEstrategiases}"> 

                                        <p:columnGroup type="header">
                                            <p:row class="success">
                                                <p:column headerText="Proyecto" style="background-color: #cccccc; color: #000000;"/>
                                                <p:column headerText="Programadas:" style="width: 100px;background-color: #cccccc; color: #000000;"/>
                                                <p:column headerText="Alcanzadas:" style="width: 100px;background-color: #cccccc; color: #000000;"/>
                                                <p:column headerText="Porcentaje:" style="width: 100px;background-color: #cccccc; color: #000000;"/>
                                                <p:column headerText="Semaforo de #{cuadroMandoIntegralArea.mes}" style="width: 120px ;background-color: #cccccc; color: #000000;"/>
                                            </p:row>                                               
                                        </p:columnGroup>

                                        <p:headerRow>
                                            <p:column styleClass="eje" style="text-align: left; color: #FFFFFF;  background: #00D8D8">
                                                <h:outputText value="#{proyectos.proyectos.proyecto}.#{proyectos.proyectos.nombre}" style="text-align: left"/>
                                            </p:column>
                                            <p:column styleClass="eje" style="text-align: center; color: #FFFFFF;  background: #00D8D8">
                                                <h:outputText value="#{proyectos.programado}" style="text-align: left; font-size: medium"/>
                                            </p:column>
                                            <p:column styleClass="eje" style="width:10% ;text-align: center; color: #FFFFFF;  background: #00D8D8">
                                                <h:outputText value="#{proyectos.alcanzado}" style="text-align: left; font-size: medium"/>
                                            </p:column>
                                            <p:column  styleClass="eje" style="width:10% ;text-align: center; color: #FFFFFF;  background: #00D8D8">
                                                <h:outputText value="#{cuadroMandoIntegralArea.df.format(proyectos.porcentaje)}%" style="text-align: left; font-size: medium"/>
                                            </p:column>
                                            <p:column styleClass="eje " style="width:10% ;text-align: center; color: #FFFFFF;  background: #00D8D8">
                                                <img src="../../resources/img/#{proyectos.semaforo}.png" alt="#{proyectos.semaforo}"/>
                                            </p:column>
                                        </p:headerRow>
                                        <p:column colspan="5">
                                            <p:dataTable var="estrategiasRegistro"  sortBy="#{estrategiasRegistro.estrategias.estrategia}" 
                                                         expandableRowGroups="true" value="#{proyectos.estrategiaActividadeses}">

                                                <p:headerRow>

                                                    <p:column colspan="1" styleClass="est" style="text-align: left; color: #FFFFFF;">
                                                        <h:outputText value="#{ejesRegistro.ejeA.eje}.#{estrategiasRegistro.estrategias.numero} -- #{estrategiasRegistro.estrategias.nombre}" style="text-align: left"/>
                                                    </p:column>
                                                </p:headerRow>
                                                <p:column colspan="1">
                                                    <p:dataTable value="#{estrategiasRegistro.actividadesPoas}" 
                                                                 var="pOa" sortBy="#{pOa.cuadroMandoInt.lineaAccion.lineaAccion}" 
                                                                 rowStyleClass="#{pOa.numeroS eq 0?'actividad':''}" 
                                                                 expandableRowGroups="true" emptyMessage="No hay actividades registradas">

                                                        <p:headerRow>
                                                            <p:column colspan="#{cuadroMandoIntegralArea.fechaActual.month +9}" styleClass="lac" style="text-align: left">
                                                                <h:outputText value="#{ejesRegistro.ejeA.eje}.#{estrategiasRegistro.estrategias.numero}.#{pOa.cuadroMandoInt.lineaAccion.numero} --#{pOa.cuadroMandoInt.lineaAccion.nombre}"/>
                                                            </p:column>
                                                        </p:headerRow>  

                                                        <f:facet name="header"></f:facet>

                                                        <p:columnGroup type="header">
                                                            <p:row class="success">
                                                                <p:column colspan="2" rowspan="2" headerText="No." style="width: 50px; background-color: #cccccc; color: #000000;"/>
                                                                <p:column rowspan="2" headerText="Actividad" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rowspan="2" headerText="Unidad de medida" style="width:150px; background-color: #cccccc; color: #000000;"/>
                                                                <p:column rowspan="2" headerText="Área" style="width:150px; background-color: #cccccc; color: #000000;"/>
                                                                <p:column rowspan="2" headerText="Área" style="width:150px; background-color: #cccccc; color: #000000;"/>
                                                                <p:column colspan="#{cuadroMandoIntegralArea.fechaActual.month +1}" headerText="Calendarización de Metas" style="width:#{(cuadroMandoIntegralArea.fechaActual.month +1)*80}px; background-color: #cccccc; color: #000000;"/>  
                                                                <p:column rowspan="2" headerText="Avance al mes de #{cuadroMandoIntegralArea.mes}" style="width: 100px; background-color: #cccccc; color: #000000;"/>
                                                                <p:column rowspan="2" headerText="Semaforización" style="width:150px; background-color: #cccccc; color: #000000;"/>
                                                            </p:row>
                                                            <p:row class="success">
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 0?true:false}" headerText="Enero" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 1?true:false}" headerText="Febrero" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 2?true:false}" headerText="Marzo" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 3?true:false}" headerText="Abril" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 4?true:false}" headerText="Mayo" style="background-color: #cccccc; color: #000000;"/>                                                    
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 5?true:false}" headerText="Junio" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 6?true:false}" headerText="Julio" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 7?true:false}" headerText="Agosto" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 8?true:false}" headerText="Septiembre" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 9?true:false}" headerText="Octubre" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 10?true:false}" headerText="Noviembre" style="background-color: #cccccc; color: #000000;"/>
                                                                <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 11?true:false}" headerText="Diciembre" style="background-color: #cccccc; color: #000000;"/>
                                                            </p:row>
                                                        </p:columnGroup>

                                                        <p:column> 
                                                            <h:outputText value="#{pOa.numeroP}" />
                                                        </p:column>
                                                        <p:column> 
                                                            <h:outputText value="#{pOa.numeroS}" />
                                                        </p:column>
                                                        <p:column style="text-align: justify"> 
                                                            <h:outputText value="#{pOa.denominacion}" /> 
                                                        </p:column>
                                                        <p:column style="text-align: justify"> 
                                                            <h:outputText value="#{pOa.unidadMedida.nombre}" />
                                                        </p:column>
                                                        <p:column style="text-align: justify"> 
                                                            <h:outputText value="#{cuadroMandoIntegralArea.areasNombre(pOa.area)}" />
                                                        </p:column>  
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 0?true:false}"> 
                                                            <h:outputText value="Planeadas" />
                                                            <hr/>
                                                            <h:outputText value="Alcanzadas"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 0?true:false}"> 
                                                            <h:outputText value="#{pOa.NPEnero}" />
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAEnero}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 1?true:false}"> 
                                                            <h:outputText value="#{pOa.NPFebrero}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAFebrero}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 2?true:false}"> 
                                                            <h:outputText value="#{pOa.NPMarzo}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAMarzo}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 3?true:false}"> 
                                                            <h:outputText value="#{pOa.NPAbril}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAAbril}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 4?true:false}"> 
                                                            <h:outputText value="#{pOa.NPMayo}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAMayo}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 5?true:false}"> 
                                                            <h:outputText value="#{pOa.NPJunio}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAJunio}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 6?true:false}"> 
                                                            <h:outputText value="#{pOa.NPJulio}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAJulio}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 7?true:false}"> 
                                                            <h:outputText value="#{pOa.NPAgosto}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAAgosto}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 8?true:false}"> 
                                                            <h:outputText value="#{pOa.NPSeptiembre}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NASeptiembre}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 9?true:false}"> 
                                                            <h:outputText value="#{pOa.NPOctubre}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NAOctubre}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 10?true:false}"> 
                                                            <h:outputText value="#{pOa.NPNoviembre}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NANoviembre}"/>
                                                        </p:column>
                                                        <p:column rendered="#{cuadroMandoIntegralArea.fechaActual.month ge 11?true:false}"> 
                                                            <h:outputText value="#{pOa.NPDiciembre}" /> 
                                                            <hr/>
                                                            <h:outputText value="#{pOa.NADiciembre}"/>
                                                        </p:column>
                                                        <p:column> 
                                                            <h:outputText value="#{cuadroMandoIntegralArea.totalProgramado(pOa)}"/>
                                                            <hr/>
                                                            <h:outputText value="#{cuadroMandoIntegralArea.totalAlcanzado(pOa)}"/>
                                                        </p:column>   
                                                        <p:column>
                                                            <img src="../../resources/img/#{cuadroMandoIntegralArea.semaforo(cuadroMandoIntegralArea.totalProgramado(pOa), cuadroMandoIntegralArea.totalAlcanzado(pOa))}.png" alt="#{cuadroMandoIntegralArea.semaforo(cuadroMandoIntegralArea.totalProgramado(pOa), cuadroMandoIntegralArea.totalAlcanzado(pOa))}"/>
                                                            <hr/>
                                                            <h:outputText value="#{cuadroMandoIntegralArea.porcentaje(cuadroMandoIntegralArea.totalProgramado(pOa), cuadroMandoIntegralArea.totalAlcanzado(pOa))}%"/>
                                                        </p:column>   
                                                    </p:dataTable>
                                                </p:column> 
                                            </p:dataTable>
                                        </p:column>
                                    </p:dataTable>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </div>
                </div>   
            </h:form>                
        </c:if>
        <c:if test="#{!controladorEmpleado.tienePOA}">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <div id="main-buttons" class="hidden-sm hidden-xs" >
                        <p:panel style="text-align: center">
                            <h1>
                                El área a la que pertenece no tiene permisos de acceso a POA 
                            </h1>
                        </p:panel>
                    </div>
                </div>
            </div>
        </c:if>
    </ui:define>
</ui:composition>

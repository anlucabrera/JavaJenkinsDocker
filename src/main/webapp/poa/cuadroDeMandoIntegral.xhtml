<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/templates/template.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:hf="http://highfaces.org"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="head-end">
        <style type="text/css">
            .ui-datatable .ui-datatable-header {
                text-align: right !important;
            }

            .minimizados{
                display: none;
            }            

        </style>
        <script>
            function descargar(ruta) {
                var win = window.open(ruta, '_blank');
                if (win) {
                    win.focus();
                }
            }
        </script>
        <script type="text/javascript">
            function myconfig() {
                this.yAxis = {
                    type: 'double',
                    min: 0,
                    max: 115,
                    tickAmount: 7,
                    plotBands: [{from: 0.0, to: 89.99, color: '#FF0000'}, {from: 90.0, to: 94.99, color: '#ffff00'}, {from: 95.0, to: 200.99, color: '#66ff33'}]
                };
            }
        </script>
        <script type="text/javascript">

        </script>
        <!-- Inicio estilos par proceso electoral -->
        <c:if test="#{utilidadesAcceso.procesoElectoralActivo}">
            <link rel="stylesheet" type="text/css" href="../resources/css/procesoElectoral.css" media="screen" />
        </c:if>        
        <link rel="stylesheet" type="text/css" href="../resources/css/estilosGenerales.css" media="screen" />
        <!-- Fin estilos par proceso electoral -->
    </ui:define>

    <ui:define name="title">
        Programa Anual de Trabajo
    </ui:define>

    <ui:define name="description">
        Cuadro de mando Integral
    </ui:define>

    <ui:define name="body">
        <c:if test="#{cuadroMandoIntegralConsulta.cargado}">
            <adm:sidebar collapsed="true"/>
            <c:if test="#{controladorEmpleado.tienePOA}">
                <h:form id="frmAreaEvaluada" prependId="false" class="form-inline">
                    <div class="box box-primary">
                        <div id="main-buttons">
                            <p:panel header="Área y mes de evaluación">
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-6">            
                                        <p:autoUpdate/>
                                        <p:outputLabel value="Área:" />
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" id="area" value="#{cuadroMandoIntegralConsulta.claveArea}" valueChangeListener="#{cuadroMandoIntegralConsulta.asignarAreaEvaluada}">
                                            <f:selectItems value="#{cuadroMandoIntegralConsulta.areasConsulta}" var="areas" itemValue="#{areas.area}" itemLabel="#{areas.area} -- #{areas.nombre}" />
                                            <p:ajax update=":frmGraficasCMI ejeR" listener="#{cuadroMandoIntegralConsulta.imprimirValores()}"/>
                                        </p:selectOneMenu> 
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-6">            
                                        <p:autoUpdate/>
                                        <p:outputLabel value="Eje:" />
                                        <p:selectOneMenu filter="true" filterMatchMode="contains" id="ejeR" value="#{cuadroMandoIntegralConsulta.claveEjeR}" valueChangeListener="#{cuadroMandoIntegralConsulta.asignarEjeEvaluado}">
                                            <f:selectItems value="#{cuadroMandoIntegralConsulta.ejesRegistros}" var="ejR" itemValue="#{ejR.eje}" itemLabel="#{ejR.eje} -- #{ejR.nombre}" />
                                            <p:ajax update=":frmGraficasCMI" listener="#{cuadroMandoIntegralConsulta.imprimirValores()}"/>
                                        </p:selectOneMenu> 
                                    </div>
                                </div>
                            </p:panel>                   
                        </div>
                    </div>
                </h:form>

                <h:form id="frmGraficasCMI" prependId="false" class="form-inline">
                    <p:growl><p:autoUpdate/></p:growl>
                    <div class="box box-primary">
                        <div id="main-buttons" class="hidden-sm hidden-xs" >                    
                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-12">            
                                    <p:panel header="Cuadro de Mando Integral #{cuadroMandoIntegralConsulta.nombreAre()}">
                                        <p:tab title="Resumen">
                                            <p:panelGrid style="margin-top:20px">
                                                <p:row>
                                                    <p:column colspan="16" style="font-weight: bold; text-align: center" styleClass="eje">#{cuadroMandoIntegralConsulta.mes}</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="2" style="font-weight: bold;">Actividades Programadas</p:column>
                                                    <p:column  style="font-weight: bold;">#{cuadroMandoIntegralConsulta.cmiGeneral.programadas}</p:column>
                                                    <p:column rowspan="5" colspan="7" style="font-weight: bold;">
                                                        <hf:chart type="line" height="400px" extender="#{cuadroMandoIntegralConsulta.cmiGeneral.extender}" render="true" updateMethod="true"
                                                                  xaxisLabel="Mes" yaxisLabel="% avance" colors="black,white">
                                                            <hf:chartSerie type="column" name="Avance Mensual Sin penalización" value="#{cuadroMandoIntegralConsulta.cmiGeneral.cumplimientoMensualSp}" var="point" point="#{cuadroMandoIntegralConsulta.df.format(point.avance)}" tickLabel="#{point.mes}" dataLabel="#{point.avanceOF}"  />
                                                            <hf:chartSerie type="column" name="Avance Mensual Con penalización" value="#{cuadroMandoIntegralConsulta.cmiGeneral.cumplimientoMensualCp}" var="point" point="#{cuadroMandoIntegralConsulta.df.format(point.avance)}" tickLabel="#{point.mes}" dataLabel="#{point.avanceOF}"  />
                                                            <hf:chartSerie type="line" name="Avance Acumulado Sin penalización" value="#{cuadroMandoIntegralConsulta.cmiGeneral.cumplimientoAcumuladoSp}" var="point" point="#{cuadroMandoIntegralConsulta.df.format(point.avance)}" tickLabel="#{point.mes}" dataLabel="#{point.valor}"  />
                                                            <hf:chartSerie type="line" name="Avance Acumulado Con penalización" value="#{cuadroMandoIntegralConsulta.cmiGeneral.cumplimientoAcumuladoCp}" var="point" point="#{cuadroMandoIntegralConsulta.df.format(point.avance)}" tickLabel="#{point.mes}" dataLabel="#{point.valor}"  />
                                                        </hf:chart>
                                                    </p:column>
                                                    <p:column rowspan="4" colspan="6" style="font-weight: bold;">
                                                        <p:chart type="metergauge" model="#{cuadroMandoIntegralConsulta.cmiGeneral.gaugeChartModel}" responsive="true" />                                      
                                                    </p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="2" style="font-weight: bold;">Actividades Alcanzadas</p:column>
                                                    <p:column colspan="2" style="font-weight: bold;">#{cuadroMandoIntegralConsulta.cmiGeneral.alcanzadas}</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="2" style="font-weight: bold;">Actividades No Alcanzadas</p:column>
                                                    <p:column colspan="2" style="font-weight: bold;">#{cuadroMandoIntegralConsulta.cmiGeneral.noAlcanzadas}</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="2" style="font-weight: bold;">Cumplimiento Sin penalización </p:column>
                                                    <p:column colspan="2" style="font-weight: bold;">#{cuadroMandoIntegralConsulta.df.format(cuadroMandoIntegralConsulta.cmiGeneral.avanceSP)}%</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="2" style="font-weight: bold;">Cumplimiento con penalización </p:column>
                                                    <p:column colspan="2" style="font-weight: bold;">#{cuadroMandoIntegralConsulta.df.format(cuadroMandoIntegralConsulta.cmiGeneral.avanceCP)}%</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column colspan="8" style="font-weight: bold; text-align: center" styleClass="eje">Resumen Mensual</p:column>
                                                    <p:column colspan="8" style="font-weight: bold; text-align: center" styleClass="eje">Resumen Acumulado</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column rowspan="2" style="font-weight: bold; text-align: center" styleClass="lac">Mes de Evaluación</p:column>
                                                    <p:column colspan="3" style="font-weight: bold; text-align: center" styleClass="lac">Actividades</p:column>
                                                    <p:column colspan="2" style="font-weight: bold; text-align: center" styleClass="lac">Sin Penalizacion</p:column>
                                                    <p:column colspan="2" style="font-weight: bold; text-align: center" styleClass="lac">Con Penalizacion</p:column>
                                                    <p:column rowspan="2" style="font-weight: bold; text-align: center" styleClass="lac2">Mes de Evaluación</p:column>
                                                    <p:column colspan="3" style="font-weight: bold; text-align: center" styleClass="lac2">Actividades</p:column>
                                                    <p:column colspan="2" style="font-weight: bold; text-align: center" styleClass="lac2">Sin Penalizacion</p:column>
                                                    <p:column colspan="2" style="font-weight: bold; text-align: center" styleClass="lac2">Con Penalizacion</p:column>
                                                </p:row>
                                                <p:row>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Programadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Alcanzadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">No Alcanzadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Porcentaje</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Semaforo</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Porcentaje</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac">Semaforo</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Programadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Alcanzadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">No Alcanzadas</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Porcentaje</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Semaforo</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Porcentaje</p:column>
                                                    <p:column style="font-weight: bold; text-align: center" styleClass="lac2">Semaforo</p:column>
                                                </p:row>
                                                <c:forEach var="i" begin="0" end="#{cuadroMandoIntegralConsulta.cmiGeneral.resumen.size()-1}">
                                                    <c:set var="resumen" value="#{cuadroMandoIntegralConsulta.cmiGeneral.resumen.get(i)}"/>
                                                    <p:row>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{resumen.mes}</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{resumen.programados}</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{resumen.alcanzadas}</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{resumen.noAlcanzadas}</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{cuadroMandoIntegralConsulta.df.format(resumen.promedioSp)}%</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}"><img src="../resources/img/#{resumen.samaforoSp}.png" alt="#{resumen.samaforoSp}"/></p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}">#{cuadroMandoIntegralConsulta.df.format(resumen.promedioCp)}%</p:column>
                                                        <p:column style="font-weight: bold; text-align: center" styleClass="#{resumen.reporteC?'actividad':''}"><img src="../resources/img/#{resumen.semaforoCp}.png" alt="#{resumen.semaforoCp}"/></p:column>
                                                        <c:if test="#{i le cuadroMandoIntegralConsulta.cmiGeneral.resumenAcumulado.size()-1}">
                                                            <c:set var="resumenAcumulado" value="#{cuadroMandoIntegralConsulta.cmiGeneral.resumenAcumulado.get(i)}"/>
                                                            <p:column style="font-weight: bold; text-align: center">#{resumenAcumulado.mes}</p:column>
                                                            <p:column style="font-weight: bold; text-align: center">#{resumenAcumulado.programados}</p:column>
                                                            <p:column style="font-weight: bold; text-align: center">#{resumenAcumulado.alcanzadas}</p:column>
                                                            <p:column style="font-weight: bold; text-align: center">#{resumenAcumulado.noAlcanzadas}</p:column>
                                                            <p:column style="font-weight: bold; text-align: center">#{cuadroMandoIntegralConsulta.df.format(resumenAcumulado.promedioSp)}%</p:column>
                                                            <p:column style="font-weight: bold; text-align: center"><img src="../resources/img/#{resumenAcumulado.samaforoSp}.png" alt="#{resumenAcumulado.samaforoSp}"/></p:column>
                                                            <p:column style="font-weight: bold; text-align: center">#{cuadroMandoIntegralConsulta.df.format(resumenAcumulado.promedioCp)}%</p:column>
                                                            <p:column style="font-weight: bold; text-align: center"><img src="../resources/img/#{resumenAcumulado.semaforoCp}.png" alt="#{resumenAcumulado.semaforoCp}"/></p:column>
                                                        </c:if>
                                                    </p:row>                                                                  
                                                </c:forEach>
                                            </p:panelGrid>
                                        </p:tab>
                                    </p:panel>
                                </div>
                            </div>
                        </div>
                    </div>
                </h:form>
            </c:if>
            <c:if test="#{!controladorEmpleado.tienePOA}">
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <div id="main-buttons" class="hidden-sm hidden-xs" >
                            <p:panel style="text-align: center">
                                <h1>
                                    El área a la que pertenece no tiene permisos de acceso a POA 
                                </h1>
                            </p:panel>
                        </div>
                    </div>
                </div>
            </c:if>
        </c:if>
    </ui:define>
</ui:composition>

<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="#{layoutMB.template}"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
                >

    <ui:define name="head-end">
        <h:outputStylesheet library="css" name="tablaDatos.css"/>
        <h:outputScript library="js" name="dialogs.js"/>
        <!-- Inicio estilos par proceso electoral -->
        <c:if test="#{utilidadesAcceso.procesoElectoralActivo}">
            <link rel="stylesheet" type="text/css" href="../../resources/css/procesoElectoral.css" media="screen"/>
        </c:if>
        <!-- Fin estilos par proceso electoral -->
    </ui:define>

    <ui:define name="title">
        Casos Críticos Registrados
    </ui:define>

    <ui:define name="description">

    </ui:define>

    <ui:define name="body">
        <!--        <style type="text/css">
                    body .ui-datatable .ui-datatable-header{
                        background: #D9F0FC !important;
                        font-weight: bold;
                        text-align: left;
                        font-size: small;
                        border-color: #000000;
                        border-top-left-radius: 0;
                        border-top-right-radius: 0;
                    }
                    .ui-panelgrid .ui-panelgrid-cell {
                        border-width: 0px;
                        padding: 0px 2px;
                    }
                </style>-->
        <adm:breadcrumb title="Casos Críticos"/>
        <adm:sidebar collapsed="true"/>
        <div class="contenedor">
            <c:if test="#{casosCriticosEstudiante.tieneAcceso}">
                <!-- zona de importación de enums -->

                <div class="box box-primary">
                    <div class="box-header with-border">

                        <h:form id="frmEncabezado" prependId="false" class="form-inline">
                            <div id="main-buttons" class="hidden-sm hidden-xs">
                                <p:toolbar id="tb">
                                    <f:facet name="left">
                                        <p:outputLabel value="Periodo activo para registro: #{caster.clavePeriodoToString(casosCriticosEstudiante.rol.periodoActivo.periodo)} " />
                                    </f:facet>
                                    <f:facet name="right">
                                        <p:commandLink class="btn btn-info" rendered="#{true}" disabled="#{false}"
                                                       onclick="PF('modalAyuda').show();"
                                                       process="@this"
                                                       title="Presione el botón para obtener ayuda sobre la operación de ésta herramienta."><i class="fa fa-question" />
                                        </p:commandLink>
                                    </f:facet>
                                </p:toolbar>
                            </div>
                        </h:form>

                        <div class="box box-solid">
                            <div class="box-body">
                                <h:form id="frmFiltros" prependId="false" class="form-inline">
                                    <c:set var="casilla" value="#{'col-sm-12 col-md-4 col-lg-2'}" />
                                    <c:set var="casilla2" value="#{'col-sm-12 col-md-8 col-lg-6'}" />
                                    <c:set var="casilla3" value="#{'col-sm-12 col-md-3 col-lg-1'}" />
                                    <c:set var="casilla4" value="#{'col-sm-12 col-md-6 col-lg-4'}" />
                                    <div class="row margin-bottom" style="margin-top: 20px;">
                                        <div class="#{casilla}">
                                            <div class="ui-material">
                                                <p:selectOneMenu id="periodo" value="#{casosCriticosEstudiante.rol.periodoSeleccionado}" converter="entityConverter" styleClass="form-control" >
                                                    <f:selectItems value="#{casosCriticosEstudiante.rol.periodosEscolares}" var="periodo" itemValue="#{periodo}" itemLabel="#{caster.periodoToString(periodo)}" />
                                                    <p:ajax process="@this" update="@this contenedor" listener="#{casosCriticosEstudiante.cambiarPeriodo}" />
                                                </p:selectOneMenu>
                                                <p:outputLabel value="Periodo" for="periodo"/>
                                                <p:message for="periodo" />
                                            </div>
                                        </div>
                                    </div>
                                </h:form>
                                <h:form id="frmRegistro" prependId="false" class="form-inline">
                                    <p:remoteCommand id="actualizarCasosCriticos" name="actualizarCasosCriticos" actionListener="#{casosCriticosEstudiante.actualizar()}" process="@this" update="contenedor" />
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 text-info">
                                            <p:outputPanel id="contenedor">
                                                <div style="margin-bottom: 10px">

                                                    <p:dataGrid var="dtoCasoCritico" 
                                                                value="#{casosCriticosEstudiante.rol.listaCasosCriticos}" 
                                                                columns="3" 
                                                                layout="grid"
                                                                rows="12" 
                                                                paginator="true" 
                                                                id="casosCriticosEstudiante"
                                                                paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {RowsPerPageDropdown} {NextPageLink} {LastPageLink}"
                                                                rowsPerPageTemplate="6,12,16,20">

                                                        <f:facet name="header">
                                                            Casos críticos registrados
                                                        </f:facet>

                                                        <p:panel header="#{dtoCasoCritico.tipo.label}" style="text-align:justify">
                                                            <h:panelGrid columns="1" style="width:100%">
                                                                
                                                                <!--<p:graphicImage library="img" name="iconoExcel.png" width="37" height="35" />-->
                                                                
                                                                <h:outputText value="#{dtoCasoCritico.estado.label}" />

                                                                <div style="margin-bottom: 5px"></div>
                                                                <h:outputText value="#{dtoCasoCritico.casoCritico.descripcion}"/>

                                                                <div style="margin-bottom: 5px"></div>
                                                                <p:commandButton id="btnConsultaDetalleCasoCritico"
                                                                                 actionListener="#{casosCriticosEstudiante.detalleCasoCritico(dtoCasoCritico)}"
                                                                                 class="btn btn-sm btn-info" 
                                                                                 icon="fa fa-search"
                                                                                 value="Consultar detalles"
                                                                                 title="Consultar detalles del caso crítico"
                                                                                 process="@this"
                                                                                 global="false"
                                                                                 />
                                                            </h:panelGrid>
                                                        </p:panel>

                                                    </p:dataGrid>
                                                </div>
                                            </p:outputPanel>
                                        </div>
                                    </div>
                                </h:form>

                                <p:dialog id="modalDetalleCasosCriticos" 
                                          widgetVar="modalDetalleCasosCriticos" 
                                          width="500" 
                                          height="500"  
                                          closeOnEscape="true" 
                                          visible="#{false}"
                                          showEffect="fade" 
                                          hideEffect="fade" 
                                          modal="true" 
                                          draggable="true" 
                                          header="Caso Crítico"
                                          styleClass="panel panel-primary" 
                                          responsive="true" 
                                          resizable="false" 
                                          maximizable="false">
                                    <h:form id="frmDetalles">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <ul class="todo-list">
                                                    <p:toolbar>
                                                        <f:facet name="left">
                                                            <span class="ui-separator"><span class="ui-icon ui-icon-grip-dotted-vertical" /></span>
                                                            <p:outputLabel value="Detalles del caso crítico registrado" style="padding-top: 5px;" />
                                                            <p></p>
                                                        </f:facet>
                                                    </p:toolbar>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Identificador: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.caso}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Estado: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.estado}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Tipo: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.tipo}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Descripción: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.descripcion}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Tutor: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.tutor eq null ? '':caster.personalActivoLabel(casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.tutor)}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Grado y Grupo: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.idEstudiante.grupo.grado}° #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.idEstudiante.grupo.literal}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Fecha de registro: #{casosCriticosEstudiante.rol.fechaCasoCritico}</span></li>

                                                    <c:if test="#{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion ne null or casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.carga ne null}">
                                                        <p:toolbar>
                                                            <f:facet name="left">
                                                                <span class="ui-separator"><span class="ui-icon ui-icon-grip-dotted-vertical" /></span>
                                                                <p:outputLabel value="Datos académicos" style="padding-top: 5px;" />
                                                                <p></p>
                                                            </f:facet>
                                                        </p:toolbar>
                                                        <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Unidad: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion.idUnidadMateria.noUnidad}</span></li>
                                                        <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Nombre unidad: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion.idUnidadMateria.nombre}</span></li>
                                                        <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Materia: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion.idUnidadMateria.idMateria.nombre}</span></li>
                                                        <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Docente: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion.carga.docente eq null ? '':caster.personalActivoLabel(casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.configuracion.carga.docente)}</span></li>
                                                    </c:if>
                                                    <p:toolbar>
                                                        <f:facet name="left">
                                                            <span class="ui-separator"><span class="ui-icon ui-icon-grip-dotted-vertical" /></span>
                                                            <p:outputLabel value="Seguimiento tutor y especialista" style="padding-top: 5px;" />
                                                            <p></p>
                                                        </f:facet>
                                                    </p:toolbar>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Comentarios del tutor: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.comentariosTutor eq null ? 'No se han registrado comentarios':casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.comentariosTutor}</span></li>

                                                    <c:if test="#{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.evidenciaTutor ne null}">
                                                        <li>
                                                            <div style="text-align: right">
                                                                <p:commandLink class="btn btn-info btn-sm"
                                                                               ajax="false"
                                                                               action="#{casosCriticosEstudiante.descargarEvidenciaTutor}" 
                                                                               target="_blank" 
                                                                               title="Descargar evidencia por parte del tutor"
                                                                               value="Descargar evidencia por parte del tutor"
                                                                               >
                                                                    <i class="fa fa-download" />
                                                                </p:commandLink>
                                                            </div>
                                                        </li>
                                                    </c:if>

                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Especialista: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.especialista eq null ? 'Aún no ha sido canalizado con ningun especialista':caster.personalActivoLabel(casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.especialista)}</span></li>
                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Comentarios del especialista: #{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.comentariosEspecialista eq null ? 'No se han registrado comentarios':casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.comentariosEspecialista}</span></li>

                                                    <c:if test="#{casosCriticosEstudiante.rol.dtoCasoCriticoSeleccionado.casoCritico.evidenciaEspecialista ne null}">
                                                        <li>
                                                            <div style="text-align: right">
                                                                <p:commandLink class="btn btn-info btn-sm"
                                                                               ajax="false"
                                                                               action="#{casosCriticosEstudiante.descargarEvidenciaEspecialista}" 
                                                                               target="_blank" 
                                                                               title="Descargar evidencia por parte del tutor"
                                                                               value="Descargar evidencia por parte del tutor"
                                                                               >
                                                                    <i class="fa fa-download" />
                                                                </p:commandLink>
                                                            </div>
                                                        </li>
                                                    </c:if>

                                                    <li><span class="text" style="text-align: justify;"><i class="fa fa-ellipsis-v"></i><i class="fa fa-ellipsis-v"></i> Fecha de cierre del caso crítico: #{casosCriticosEstudiante.rol.fechaCierreCasoCritico}</span></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </h:form>

                                </p:dialog>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- Zona de cuadros de diálogo -->
            </c:if>
            <c:if test="#{!casosCriticosEstudiante.tieneAcceso}">
                <p:panel id="box-colors-panel" header="Acceso no autorizado" styleClass="box-fatal box-solid">
                    <h:panelGrid columns="2" cellpadding="10">
                        <h:outputText value="El acceso solo está autorizado para estudiantes."/>
                    </h:panelGrid>
                    <f:facet name="footer"></f:facet>
                </p:panel>
            </c:if>
        </div>
    </ui:define>
</ui:composition>

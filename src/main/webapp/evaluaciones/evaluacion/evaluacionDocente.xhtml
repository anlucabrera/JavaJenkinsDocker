<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="#{layoutMB.template}"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:o="http://omnifaces.org/ui">
    <ui:define name="head-end">
        <h:outputStylesheet library="css" name="tablaDatos.css"/>
        <!-- Inicio estilos par proceso electoral -->
        <link rel="stylesheet" type="text/css" href="../../resources/css/estilosEvaluacion.css" media="screen"/>
        <!-- Fin estilos par proceso electoral -->
        <script>
            function contarcaracteres(t, idP, id) {

                var total = t;

                setTimeout(function () {
                    var valor = document.getElementById(idP);
                    var respuesta = document.getElementById(id);
                    var cantidad = valor.value.toString().trim().length;
                    if (cantidad > total) {
                        respuesta.style.color = "black";
                        document.getElementById(id).innerHTML = cantidad + ' caractere/s';
                    } else {
                        document.getElementById(id).innerHTML = cantidad + ' caractere/s, te faltan ' + (total - cantidad);
                        respuesta.style.color = "red";
                    }
                }, 10);

            }
        </script>
    </ui:define>
    <ui:define name="title">
        Evaluación docente
    </ui:define>
    <ui:define name="description">
        Desempeño docente por materia
    </ui:define>
    <ui:define name="body">
        <c:if test="#{evaluacionDocenteEstudiante.cargada}">
            <div class="contenedor">
                <c:if test="#{evaluacionDocenteEstudiante.cargada}">
                    <div class="box box-primary" style="margin-bottom: 10px">
                        <div class="box-header with-border" style="padding: 1px 10px;">
                            <div id="main-buttons" class="hidden-sm hidden-xs">
                                <h:form id="frmAviso">
                                    <p:toolbar id="tb">
                                        <f:facet name="left">
                                            <p:outputLabel value="Estimada(o) estudiante: Para una evaluación objetiva, favor de considerar las actividades que se realizaron durante el periodo activo y el trabajo que han podido realizar los docentes, a pesar de la contingencia." />
                                            <p:spacer width="5" />

                                        </f:facet>
                                    </p:toolbar>

                                </h:form>
                            </div>
                        </div>
                        <div class="box box-solid" style="margin-bottom: 10px">
                            <div class="box-body">
                                <c:set var="panel" value="#{'col-sm-12 col-md-9 col-xs-12 col-lg-9'}"/>
                                <c:set var="panel2" value="#{'col-sm-12 col-md-3 col-xs-12 col-lg-3'}"/>
                                <c:set var="casilla" value="#{'col-sm-12 col-md-6 col-lg-2'}" />
                                <c:set var="casilla2" value="#{'col-sm-12 col-md-8 col-lg-6'}" />
                                <c:set var="casilla3" value="#{'col-sm-12 col-md-3 col-lg-1'}" />
                                <c:set var="casilla4" value="#{'col-sm-3 col-md-3 col-lg-3'}"/>
                                <c:set var="casilla5" value="#{'col-sm-4 col-md-4 col-lg-4'}"/>
                                <c:set var="casilla6" value="#{'col-sm-8 col-md-8 col-lg-8'}"/>
                                <c:set var="casilla7" value="#{'col-sm-6 col-md-6 col-lg-6'}"/>
                                <div class="row text-info text-center">
                                    <div class="col-lg-12 col-md-12 ">
                                        <div class="row margin-bottom">
                                            <h:form id="frmDatos">
                                                <!-- Datos de avance de la evaluación -->
                                                <div class="#{panel2}">
                                                    <div class="box box-primary" style="margin-bottom: 5px">
                                                        <div class="box-header panel-heading with-border" style="padding: 1px 10px">
                                                            <div class="pull-left"><i class="fa fa-user-o"></i></div>
                                                            <h3 class="box-title hidden-xs hidden-sm">Evaluador</h3>
                                                        </div>
                                                        <div class="box-body" style="padding: 1px 10px">
                                                            <div class="row">
                                                                <div class="card card-primary card-outline">
                                                                    <div class="card-body box-profile">
                                                                        <h4 class="hidden-xs hidden-sm">
                                                                            <span class="label #{evaluacionDocenteEstudiante.finalizado?'label-success':'label-warning'}">
                                                                                <i class="fa #{evaluacionDocenteEstudiante.finalizado?'fa-check':'fa-close'}"/>
                                                                                #{evaluacionDocenteEstudiante.finalizado?'Finalizado':'Pendiente'}
                                                                            </span>
                                                                        </h4>
                                                                        <c:if test="#{evaluacionDocenteEstudiante.estudianteSauiit}">
                                                                            <div class="text-center hidden-xs hidden-sm">
                                                                                <img class="profile-user-img img-fluid img-circle"
                                                                                     src="http://escolar.utxicotepec.edu.mx/saiiut2/imagenes/alumnos/#{evaluacionDocenteEstudiante.rol.dtoEstudiante.matricula}.jpg"
                                                                                     alt="User profile picture"></img>
                                                                            </div>
                                                                        </c:if>
                                                                        <c:if test="#{evaluacionDocenteEstudiante.estudianteCE}">
                                                                            <div class="text-center hidden-xs hidden-sm">
                                                                                <img class="profile-user-img img-fluid img-circle"
                                                                                     src="http://siip.utxicotepec.edu.mx/archivos/evidencias2/control_escolar/fotos/#{evaluacionDocenteEstudiante.rol.dtoEstudiante.matricula}.jpg"
                                                                                     alt="User profile picture"></img>
                                                                            </div>
                                                                        </c:if>
                                                                        <h3 class="profile-username text-center hidden-xs hidden-sm" style="margin-top: 2px; margin-bottom: 1px;">#{evaluacionDocenteEstudiante.rol.dtoEstudiante.nombreCEstudiante}</h3>
                                                                        <p class="text-muted text-center hidden-xs hidden-sm" style="margin-bottom: 0px">#{evaluacionDocenteEstudiante.rol.dtoEstudiante.grado} - #{evaluacionDocenteEstudiante.rol.dtoEstudiante.grupo}</p>
                                                                        <p class="text-muted text-center hidden-xs hidden-sm" style="margin-bottom: 0px">#{evaluacionDocenteEstudiante.rol.dtoEstudiante.carrera.nombre}</p>
                                                                        <ul class="list-group list-group-unbordered mb-3" style="margin-bottom: 5px">
                                                                            <li class="list-group-item hidden-xs hidden-sm" style="padding-top: 3px; padding-bottom: 2px">
                                                                                <b>Total docentes:</b> <a class="right floated">#{evaluacionDocenteEstudiante.rol.totalDocentes}</a>
                                                                            </li>
                                                                            <li class="list-group-item hidden-xs hidden-sm" style="padding-top: 3px; padding-bottom: 2px">
                                                                                <b>Evaluados:</b> <a class="right floated">#{evaluacionDocenteEstudiante.rol.evaluados}</a>
                                                                            </li>
                                                                            <li class="list-group-item" style="padding-top: 3px; padding-bottom: 2px">
                                                                                <b>Porcentaje de avance:</b>
                                                                                <div class="progress" style="margin-bottom: 2px">
                                                                                    <div class="progress-bar #{evaluacionDocenteEstudiante.finalizado? 'pgr-success':'pgr-warning'} progress-bar-striped active" role="progressbar"
                                                                                         aria-valuenow="#{evaluacionDocenteEstudiante.porcentaje}" aria-valuemin="0" aria-valuemax="100"
                                                                                         style="width:#{evaluacionDocenteEstudiante.porcentaje}%">
                                                                                        <span class="progress-completed">
                                                                                            <h:outputText value="#{evaluacionDocenteEstudiante.porcentaje}" style="color: #0E0000; font-weight: bold">
                                                                                                <f:convertNumber type="percent" pattern="0.00"/>
                                                                                            </h:outputText>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row row-information">
                                                                <c:set var="index" value="#{1}"/>
                                                                <c:forEach items="#{evaluacionDocenteEstudiante.rol.listaResultados}" var="evaluado">
                                                                    <div class="col-lg-12 col-md-12 col-sm-4 col-xs-6" style="padding-right: 1px; padding-left: 1px">
                                                                        <c:set var="c" value="#{evaluacionDocenteEstudiante.completo(evaluado)}"/>
                                                                        <c:set var="v" value="#{c?'bg-green':'bg-yellow'}"/>
                                                                        <c:set var="b" value="#{c?'btn-success':'btn-warning'}"/>
                                                                        <div class="info-box #{v}">
                                                                            <span class="info-box-icon hidden-xs hidden-sm">
                                                                                <img class="profile-user-img img-fluid img-circle" 
                                                                                     src="http://siip.utxicotepec.edu.mx/archivos/evidencias2/personal/#{evaluado.docenteImparte.clave}.jpg" 
                                                                                     alt="User profile picture"></img>
                                                                            </span>
                                                                            <div class="info-box-content">
                                                                                <span class="info-box-number">
                                                                                    #{evaluacionDocenteEstudiante.completo(evaluado)?'Finalizado':'Pendiente'}                                                                                            
                                                                                </span>
                                                                                <span class="info-box-more" style="color: #ffffff;">#{evaluado.nombreMateria}</span>
                                                                                <span class="info-box-number hidden-md hidden-sm hidden-xs">#{evaluado.docenteImparte.nombre}</span>
                                                                                <p:commandButton value="Ver evaluación" class="btn btn-block #{b} btn-sm" icon="fa fa-arrow-right" iconPos="right"
                                                                                                 actionListener="#{evaluacionDocenteEstudiante.getdocenteEvaluando(evaluado)}" process="@this"
                                                                                                 update="optPanel" style="font-size: 11px; padding-right: 0px; padding-left: 0px; padding-bottom: 0px; padding-top: 0px">
                                                                                </p:commandButton>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <c:set var="index" value="#{index + 1}"/>
                                                                </c:forEach>
                                                            </div>
                                                            <br/><br/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="#{panel}">
                                                    <div class="box box-primary" style="margin-bottom: 5px">
                                                        <div class="box-header panel-heading with-border" style="padding: 1px 10px">
                                                            <div class="pull-left"><i class="fa fa-file-text-o"></i></div>
                                                            <h3 class="box-title">Evaluación</h3>
                                                        </div>
                                                        <div class="box-body" style="padding: 1px 10px">
                                                            <div class="row">
                                                                <p:outputPanel id="optPanel">
                                                                    <div class="box-body" style="padding: 1px 10px">
                                                                        <div class="row" style="background-color: white;margin: auto">
                                                                            <div class="row">
                                                                                <div class="chart-switcher d-flex d-md-none flex-row justify-content-center align-items-center">

                                                                                    <c:set var="clave" value="#{evaluacionDocenteEstudiante.dtoDocenteEvaluando.docenteImparte.clave}" />
                                                                                    <c:set var="docente" value="#{evaluacionDocenteEstudiante.dtoDocenteEvaluando}" />
                                                                                    <a class="previous-example" title="Anterior" href="#" style="display: none" onclick="$('.carouselEB').carousel('prev');$('.carouselEB').carousel('pause');">
                                                                                        <i class="fa fa-angle-left"></i>
                                                                                    </a>
                                                                                    <label class="seleccionado hidden-sm hidden-xs" style="font-size: large; font-weight: bold; background-color: aliceblue;">
                                                                                        <span class="label #{evaluacionDocenteEstudiante.completo(docente)?'label-success':'label-warning'}">
                                                                                            <i class="fa #{evaluacionDocenteEstudiante.completo(docente)?'fa-check':'fa-close'}"/>
                                                                                            #{evaluacionDocenteEstudiante.completo(docente)?'Finalizado':'Pendiente'}
                                                                                        </span><br/>
                                                                                        <p:outputLabel value="#{docente.docenteImparte.nombre}" /><br/>
                                                                                        <img src="http://siip.utxicotepec.edu.mx/archivos/evidencias2/personal/#{clave}.jpg" width="150"
                                                                                             alt="#{clave}" title="Personal #{clave}"
                                                                                             style="border-color: black; border-style: solid; border-width: 2px;" /><br/>
                                                                                        <p:outputLabel value="#{docente.nombreMateria}" /><br/>
                                                                                    </label>
                                                                                    <label class="seleccionado hidden-lg hidden-md" style="font-size: 12px; font-weight: bold; background-color: aliceblue;">
                                                                                        <span class="label #{evaluacionDocenteEstudiante.completo(docente)?'label-success':'label-warning'}">
                                                                                            <i class="fa #{evaluacionDocenteEstudiante.completo(docente)?'fa-check':'fa-close'}"/>
                                                                                            #{evaluacionDocenteEstudiante.completo(docente)?'Finalizado':'Pendiente'}
                                                                                        </span><br/>
                                                                                        <p:outputLabel value="#{docente.docenteImparte.nombre}" style="font-size: 12px"/><br/>
                                                                                        <img class="profile-user-img img-fluid img-circle" style="width: 80px"
                                                                                             src="http://siip.utxicotepec.edu.mx/archivos/evidencias2/personal/#{clave}.jpg" 
                                                                                             alt="User profile picture"></img><br/>
                                                                                        <p:outputLabel value="#{docente.nombreMateria}" style="font-size: 12px"/><br/>
                                                                                    </label>
                                                                                    <a class="next-example" title="Siguiente" href="#" style="display: none" onclick="$('.carouselEB').carousel('next');$('.carouselEB').carousel('pause');">
                                                                                        <i class="fa fa-angle-right"></i>
                                                                                    </a>
                                                                                </div>
                                                                            </div>
                                                                            <hr style="margin-top: 1px; margin-bottom: 1px;"/>
                                                                            <div class="row">
                                                                                <c:forEach var="apartado" items="#{evaluacionDocenteEstudiante.obtenerApartados()}">
                                                                                    <div class="panel #{utilidadesAcceso.procesoElectoralActivo? 'panel-default':'panel-primary'}" style="max-width: 1000px;margin: auto; font-size: large;">
                                                                                        <div class="panel-heading" style="padding: 3px 15px">
                                                                                            <h3 class="panel-title" style="text-align: justify;">
                                                                                                #{apartado.contenido}
                                                                                            </h3>
                                                                                        </div>
                                                                                        <table class="table table-striped table-responsive" style="border-color: #5C5C5C">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <th>#</th>
                                                                                                    <th>Pregunta</th>
                                                                                                    <th style="text-align: center; width: auto;">Opción</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                                <c:forEach items="#{apartado.preguntas}" var="pregunta">
                                                                                                    <tr>
                                                                                                        <td><h:outputLabel value="#{pregunta.numero}"><f:convertNumber pattern="##.#" /></h:outputLabel></td>
                                                                                                        <td style="text-align: justify;">
                                                                                                            <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion != 4}">
                                                                                                                #{pregunta.titulo}
                                                                                                            </c:if>
                                                                                                            <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion == 4}">
                                                                                                                <c:if test="#{pregunta.numero eq 22.0}">En general, el desempeño del docente fue.</c:if>
                                                                                                                <c:if test="#{pregunta.numero ne 22.0}">#{pregunta.titulo}</c:if>
                                                                                                            </c:if>
                                                                                                        </td>
                                                                                                        <td class="text-center">
                                                                                                            <f:ajax execute="r#{pregunta.numero.intValue()}">
                                                                                                                <c:set var="pos" value="#{'r'.concat(pregunta.numero.intValue())}" />
                                                                                                                <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion == 1}">
                                                                                                                    <p:selectOneButton id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}" 
                                                                                                                                       valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                        <f:selectItems value="#{evaluacionDocenteEstudiante.obtenerItems()}" />
                                                                                                                        <p:ajax process="@this" update="@form"/>
                                                                                                                    </p:selectOneButton>
                                                                                                                </c:if>
                                                                                                                <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion == 2}">
                                                                                                                    <p:selectOneButton id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}" 
                                                                                                                                       valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                        <f:selectItems value="#{evaluacionDocenteEstudiante.obtenerItems()}" />
                                                                                                                        <p:ajax process="@this" update="@form"/>
                                                                                                                    </p:selectOneButton>
                                                                                                                </c:if>
                                                                                                                <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion == 3}">
                                                                                                                    <c:if test="#{pregunta.numero ne 20.0}">
                                                                                                                        <p:selectOneButton id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}" 
                                                                                                                                           valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                            <f:selectItems value="#{evaluacionDocenteEstudiante.obtenerItems()}" />
                                                                                                                            <p:ajax process="@this" update="@form"/>
                                                                                                                        </p:selectOneButton>
                                                                                                                    </c:if>
                                                                                                                    <c:if test="#{pregunta.numero eq 20.0}">
                                                                                                                        <p:inputTextarea  id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}"
                                                                                                                                          onkeyup="contarcaracteres(11, 'frmDatos:r#{pregunta.numero.intValue()}', 'out20')"
                                                                                                                                          valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                            <p:ajax process="@this" update="@form"/>
                                                                                                                        </p:inputTextarea>
                                                                                                                        <div id="out20"></div>
                                                                                                                    </c:if>
                                                                                                                </c:if>
                                                                                                                <c:if test="#{evaluacionDocenteEstudiante.rol.tipoEvaluacion == 4}">
                                                                                                                    <c:if test="#{pregunta.numero ne 22.0}">
                                                                                                                        <p:selectOneButton id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}" 
                                                                                                                                           valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                            <f:selectItems value="#{evaluacionDocenteEstudiante.obtenerItems()}" />
                                                                                                                            <p:ajax process="@this" update="@form"/>
                                                                                                                        </p:selectOneButton>
                                                                                                                    </c:if>
                                                                                                                    <c:if test="#{pregunta.numero eq 22.0}">
                                                                                                                        <p:inputTextarea  id="r#{pregunta.numero.intValue()}" value="#{evaluacionDocenteEstudiante.rol.respuestas[pos]}"
                                                                                                                                          onkeyup="contarcaracteres(11, 'frmDatos:r#{pregunta.numero.intValue()}', 'out22')"
                                                                                                                                          valueChangeListener="#{evaluacionDocenteEstudiante.guardarRespuesta}">
                                                                                                                            <p:ajax process="@this" update="@form"/>
                                                                                                                        </p:inputTextarea>
                                                                                                                        <div id="out22"></div>
                                                                                                                    </c:if>
                                                                                                                </c:if>
                                                                                                            </f:ajax>
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                </c:forEach>                                                
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </c:forEach>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </p:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </h:form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </c:if>
                <c:if test="#{!evaluacionDocenteEstudiante.cargada}">
                    <p:panel id="box-colors-panel" header="Acceso no autorizado" styleClass="box-fatal box-solid">
                        <h:panelGrid columns="2" cellpadding="10">
                            <h:outputText value="No existe evaluación activa"/>
                        </h:panelGrid>
                        <f:facet name="footer"></f:facet>
                    </p:panel>
                </c:if>
            </div>
        </c:if>
    </ui:define>
</ui:composition>
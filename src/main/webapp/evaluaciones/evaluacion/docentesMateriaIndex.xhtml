<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="#{layoutMB.template}"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:o="http://omnifaces.org/ui">

    <ui:define name="head-end">
        <h:outputStylesheet library="css" name="tablaDatos.css"/>
        <!-- Inicio estilos par proceso electoral -->
        <c:if test="#{utilidadesAcceso.procesoElectoralActivo}">
            <link rel="stylesheet" type="text/css" href="../resources/css/procesoElectoral.css" media="screen"/>
        </c:if>
        <!-- Fin estilos par proceso electoral -->
    </ui:define>

    <ui:define name="title">
        Evaluación al desempeño docente por materia
    </ui:define>

    <ui:define name="description">
        Avance de la evaluación
    </ui:define>

    <ui:define name="head-end">
        <h:outputStylesheet library="css" name="tablaDatos.css"/>
        <h:outputScript library="js" name="dialogs.js"/>
    </ui:define>

    <ui:define name="body">
        <adm:breadcrumb title="Avance de la evaluación"/>
        <div class="contenedor">
            <c:if test="#{evaluacionDoncenteMateriaControler.cargada}">
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <h:form id="frm">
                        <p:tabView id="tabw1">
                            <p:tab title="Avance de la evaluación">
                                <section class="content">
                                        <div class="row" ondragstart="return false" onselectstart="return false" oncontextmenu="return false">
                                            <div class="col-md-12">
                                                    <div class="container-fluid">
                                                        <div class="row">
                                                            <div class="col-md-2">
                                                                <div class="card card-primary card-outline">
                                                                    <div class="card-body box-profile">
                                                                        <c:if test="#{evaluacionDoncenteMateriaControler.finalizado}">
                                                                            <h4><span class="label label-success"><i class="fa fa-check" />Finalizado.</span></h4>
                                                                        </c:if>
                                                                        <c:if test="#{!evaluacionDoncenteMateriaControler.finalizado}">
                                                                            <h4><span class="label label-warning"><i class="fa fa-close" />Pendiente</span></h4>
                                                                        </c:if>
                                                                        <br/>

                                                                        <c:if test="#{evaluacionDoncenteMateriaControler.estudianteSauiit}">
                                                                            <div class="text-center">
                                                                                <img class="profile-user-img img-fluid img-circle"
                                                                                     src="https://150.140.1.9:8181/saiiut2/imagenes/alumnos/#{evaluacionDoncenteMateriaControler.estudianteEvaluacion.matricula}.jpg"
                                                                                     alt="User profile picture"></img>
                                                                            </div>
                                                                        </c:if>
                                                                        <c:if test="#{evaluacionDoncenteMateriaControler.estudianteCE}">
                                                                            <div class="text-center">
                                                                                <img class="profile-user-img img-fluid img-circle"
                                                                                     src="http://siip.utxicotepec.edu.mx/archivos/evidencias2/control_escolar/fotos/#{evaluacionDoncenteMateriaControler.estudianteEvaluacion.matricula}.jpg"
                                                                                     alt="User profile picture"></img>
                                                                            </div>
                                                                        </c:if>
                                                                        <h3 class="profile-username text-center">#{evaluacionDoncenteMateriaControler.estudianteEvaluacion.nombreCEstudiante}</h3>
                                                                        <p class="text-muted text-center">#{evaluacionDoncenteMateriaControler.estudianteEvaluacion.grado} - #{evaluacionDoncenteMateriaControler.estudianteEvaluacion.grupo}</p>
                                                                        <p class="text-muted text-center">#{evaluacionDoncenteMateriaControler.estudianteEvaluacion.carrera.nombre}</p>
                                                                        <ul class="list-group list-group-unbordered mb-3">
                                                                            <li class="list-group-item">
                                                                                <b>Total docentes:</b> <a class="right floated">#{evaluacionDoncenteMateriaControler.totalDocentes}</a>
                                                                            </li>
                                                                            <li class="list-group-item">
                                                                                <b>Evaluados:</b> <a class="right floated">#{evaluacionDoncenteMateriaControler.evaluados2}</a>
                                                                            </li>
                                                                            <li class="list-group-item">
                                                                                <b>Porcentaje de avance:</b>
                                                                                <div class="progress">
                                                                                    <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar"
                                                                                         aria-valuenow="#{evaluacionDoncenteMateriaControler.porcentaje}" aria-valuemin="0" aria-valuemax="100"
                                                                                         style="background-color: #00a65a; width:#{evaluacionDoncenteMateriaControler.porcentaje}%">
                                                                                        <span class="progress-completed">
                                                                                             <h:outputText value="#{evaluacionDoncenteMateriaControler.porcentaje}" style="color: #0E0000; font-weight: bold">
                                                                                                 <f:convertNumber type="percent" pattern="0.00"/>
                                                                                             </h:outputText>
                                                                                        </span>
                                                                                    </div>

                                                                                </div>
                                                                            </li>
                                                                        </ul>

                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="col-md-8">
                                                                <p:tabView id="tabw2">
                                                                    <p:tab title="Docentes" >
                                                                        <section class="content">
                                                                            <div class="row" ondragstart="return false" onselectstart="return false" oncontextmenu="return false">
                                                                                    <div class="col-md-12">
                                                                                        <c:forEach items="#{evaluacionDoncenteMateriaControler.listaResultados}" var="evaluado">
                                                                                            <div class="col-md-6 col-sm-6 col-12">
                                                                                                <c:if test="#{evaluado.resultados.completo}">
                                                                                                    <div class="small-box bg-green">
                                                                                                        <span class="info-box-icon"> <img class="profile-user-img img-fluid img-circle"
                                                                                                                                          src="http://siip.utxicotepec.edu.mx/sgot-images/evidencias/personal/#{evaluado.docenteImparte.clave}.jpg"
                                                                                                                                          alt="User profile picture"></img></span>
                                                                                                        <div class="info-box-content">
                                                                                                            <span class="info-box-number">Finalizado</span>
                                                                                                            <span class="info-box-more">#{evaluado.docenteImparte.nombre}</span>
                                                                                                            <span class="info-box-number">#{evaluado.nombreMateria}</span>

                                                                                                        </div>

                                                                                                        <p:commandButton value="Ver evaluación" class="btn btn-block btn-success btn-sm"
                                                                                                                         actionListener="#{evaluacionDoncenteMateriaControler.getdocenteEvaluando(evaluado)}"
                                                                                                                         oncomplete="PF('modalEvaluacion').show();" 

                                                                                                        >
                                                                                                            <p:ajax process="@this" oncomplete="updateEvaluacion"/>
                                                                                                        </p:commandButton>

                                                                                                    </div>
                                                                                                </c:if>
                                                                                                <c:if test="#{!evaluado.resultados.completo}">
                                                                                                    <div class="small-box bg-yellow">
                                                                                                        <span class="info-box-icon"> <img class="profile-user-img img-fluid img-circle"
                                                                                                                                          src="http://siip.utxicotepec.edu.mx/sgot-images/evidencias/personal/#{evaluado.docenteImparte.clave}.jpg"
                                                                                                                                          alt="User profile picture"></img></span>
                                                                                                        <div class="info-box-content">
                                                                                                            <span class="info-box-number">Pendiente</span>
                                                                                                            <span class="info-box-more">#{evaluado.docenteImparte.nombre}</span>
                                                                                                            <span class="info-box-number">#{evaluado.nombreMateria}</span>

                                                                                                        </div>
                                                                                                        <p:commandButton value="Evaluar" class="btn btn-block btn-warning btn-sm"
                                                                                                                         actionListener="#{evaluacionDoncenteMateriaControler.getdocenteEvaluando(evaluado)}"
                                                                                                                         oncomplete="PF('modalEvaluacion').show();"

                                                                                                        >
                                                                                                            <p:ajax process="@this" oncomplete="updateEvaluacion"/>
                                                                                                        </p:commandButton>
                                                                                                    </div>
                                                                                                </c:if>
                                                                                            </div>
                                                                                        </c:forEach>
                                                                                    </div>
                                                                            </div>
                                                                        </section>
                                                                    </p:tab>

                                                                </p:tabView>
                                                            </div>


                                                        </div>
                                                    </div>
                                            </div>
                                        </div>


                                </section>
                            </p:tab>
                        </p:tabView>
                        </h:form>

                    </div>
                </div>
                <p:dialog id="modalEvaluacion"
                          widgetVar="modalEvaluacion" closeOnEscape="false" visible="#{false}" showEffect="fade" hideEffect="fade"
                          style="scroll-: 10px"
                          modal="true" draggable="true" header="Evaluación al desempeño docente por materia" position="center" styleClass="panel panel-primary" responsive="true" resizable="true" closable="false" maximizable="true">
                    <h:form id="frmEvaluacion">
                        <p:scrollPanel style="width: 1100px;height: 800px" mode="false">
                            <p:remoteCommand id="updateEvaluacion" name="updateEvaluacion" update="frmEvaluacion"></p:remoteCommand>
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                 
                                    <p:separator/>
                                    <div class="box-body">
                                        <div jsf:id="filaHeader" class="row hidden-sm hidden-md hidden-sm hidden-xs" style="background-color: white;margin: auto">
                                            <div class="col-lg-4 col-md-6 col-lg-offset-2 text-center text-info" style="height: 230px; vertical-align: middle;">
                                                <p:outputPanel >
                                                    <c:if test="#{evaluacionDoncenteMateriaControler.dtoDocenteEvaluando.resultados.completo}">
                                                        <div>
                                                        </div>
                                                    </c:if>
                                                </p:outputPanel>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-4 text-center" style="padding-left: 2px; padding-right: 2px; background-color: aliceblue;">
                                                    <c:set var="numeroNomina" value="#{evaluacionDoncenteMateriaControler.dtoDocenteEvaluando.docenteImparte.clave}" />
                                                    <c:set var="docente" value="#{evaluacionDoncenteMateriaControler.dtoDocenteEvaluando}" />
                                                    <p:outputPanel >
                                                        <h4 class="#{docente.resultados.completo?'text-info':'text-warn'} " style="margin: 0px;">#{docente.resultados.completo?'Finalizado':'Pendiente'}</h4>
                                                        <img src="http://siip.utxicotepec.edu.mx/sgot-images/evidencias/personal/#{numeroNomina}.jpg" width="150"
                                                             alt="#{numeroNomina}" title="Personal #{numeroNomina}"
                                                             style="border-color: black; border-style: solid; border-width: 2px;" />
                                                    </p:outputPanel>
                                                    <p:outputLabel value="#{docente.docenteImparte.nombre}" />
                                                    <br/>
                                                    <p:outputLabel value="#{docente.nombreMateria}" />
                                                </div>

                                            </div>
                                            <c:set var="index" value="#{1}" />
                                            <c:forEach items="#{evaluacionDoncenteMateriaControler.preguntas}" var="apartado">
                                                <div class="row">
                                                    <div class="panel panel-primary" style="max-width: 900px;margin: auto; font-size: large;">
                                                        <div class="panel-heading aceptado">
                                                            <h3 class="panel-title" style="text-align: justify;">
                                                                #{apartado.contenido}
                                                            </h3>
                                                        </div>
                                                        <table class="table table-striped table-responsive">
                                                            <thead>
                                                            <tr class="denegado">
                                                                <th>#</th>
                                                                <th>Pregunta</th>
                                                                <th style="text-align: center; width: 280px;">Opción</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <c:forEach items="#{apartado.preguntas}" var="pregunta">
                                                                <tr>
                                                                    <td><h:outputLabel value="#{pregunta.numero}"><f:convertNumber pattern="##.#" /></h:outputLabel></td>
                                                                    <td style="text-align: justify;">#{pregunta.titulo}</td>
                                                                    <td class="text-center" style="min-width: 120px;">
                                                                        <c:if test="#{pregunta.tipo == 3}">
                                                                            <f:ajax execute="r#{index}">
                                                                                <c:set var="pos" value="#{'r'.concat(index)}" />
                                                                                <p:selectOneButton  id="r#{index}" value="#{docente.resultados[pos]}"
                                                                                                    valueChangeListener="#{evaluacionDoncenteMateriaControler.saveRespueta}">
                                                                                    <p:ajax process="@this" global="false"/>
                                                                                    <f:selectItems class="btn-primary" value="#{evaluacionDoncenteMateriaControler.respuestasPosibles}" />
                                                                                </p:selectOneButton>
                                                                            </f:ajax>
                                                                        </c:if>
                                                                        <c:if test="#{pregunta.tipo == 1}">
                                                                            <f:ajax execute="r#{index}">
                                                                                <c:set var="pos" value="#{'r'.concat(index)}" />
                                                                                <p:inputTextarea id="r#{index}" class="form-control"
                                                                                                 value="#{docente.resultados[pos]}"
                                                                                                 rows="6" placeholder="Ingrese sus comentarios aquí..." maxlength="500" counter="display" counterTemplate="{0} Caracteres restantes."
                                                                                                 valueChangeListener="#{evaluacionDoncenteMateriaControler.saveRespueta}" queryDelay="1500" />
                                                                                <br/>
                                                                                <p:ajax process="@this" />
                                                                                <h:outputText id="display" />
                                                                            </f:ajax>
                                                                        </c:if>
                                                                        <c:set var="index" value="#{index+1}" />
                                                                    </td>
                                                                </tr>
                                                            </c:forEach>
                                                            </tbody>
                                                        </table>



                                                    </div>
                                                </div>
                                            </c:forEach>
                                            <p:spacer width="30px"/>
                                            <div class="row">
                                                <div class="col-lg-5"/>
                                                <div class="col-lg-4">
                                                    <p:commandButton value="Continuar evaluado" styleClass="btn-primary"
                                                                     onclick="PF('modalEvaluacion').hide();"

                                                    >
                                                        <p:ajax process="@this" update=":frm"/>
                                                    </p:commandButton>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </p:scrollPanel>

                    </h:form>


                </p:dialog>

            </c:if>

        </div>



        <script>
            //collapseSidebar(); activar para colapsar barra lateral
        </script>
    </ui:define>
</ui:composition>

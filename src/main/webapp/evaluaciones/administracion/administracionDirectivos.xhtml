<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="#{layoutMB.template}"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:hf="http://highfaces.org" 
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="head-end">
        <style type="text/css">
            .ui-datatable .ui-datatable-header {
                text-align: right !important;
            }
            .description-block{
                text-align: justify;
            }

            .description-header{
                text-align: center;
            }

            .ui-selectonemenu-panel .ui-selectonemenu-filter-container{
                width: 100%;
            }
            .aceptado {
                background-color: #00a7d0  !important;
                text-align: left !important;
            }
            .denegado{
                background-color: #f39c12 !important;
            }
            .progress{
                margin-bottom: 0px !important;
            }
            .ui-progressbar{
                position: relative;
                height: 2em;
            }

            .ui-progressbar .ui-progressbar-label {
                color: #000000;
                text-align: center;
                height: 100%;
                width: 100%;
                position: absolute;
                display: none;
                font-weight: bold;
            }
        </style>
    </ui:define>

    <ui:define name="title">
        Consulta de resultados del persona a su cargo
    </ui:define>

    <ui:define name="description">

    </ui:define>

    <ui:define name="body">
        <script>
            function descargar(ruta) {
                var win = window.open(ruta, '_blank');
                if (win) {
                    win.focus();
                }
            }
        </script>
        <section>
            <c:if test="#{administracionDirectivos.cargado}">
                <div class="contenedor">
                    <c:if test="#{administracionDirectivos.tieneAcceso}">
                        <h:form id="frm" prependId="false" class="form-inline">
                            <div class="col-md-12">
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <div id="main-buttons" class="hidden-sm hidden-xs">
                                            <p:toolbar id="tb">
                                                <f:facet name="left">
                                                </f:facet>
                                                <f:facet name="right">
                                                    <!--p:commandButton value="Descargar cédulas 360°" id="btnResultadoPersonal" 
                                                                     rendered="# {administracionDirectivos.rol.renderBtnDownloadCedulas360}"
                                                                     title="Clic para generar las cédulas de la evaluación de 360°" disabled="true"
                                                                     actionListener="# {administracionDirectivos.descargarCedulas()}" 
                                                                     process="@this" icon="fa fa-download" styleClass="btn-primary"/-->
                                                    <p:commandButton value="Descargar cédulas Desempeño" id="btnResultadoDesempenio" 
                                                                     rendered="#{administracionDirectivos.rol.renderBtnDownloadCedulasDes}"
                                                                     title="Clic para generar las cédulas de Desempeño"
                                                                     actionListener="#{administracionDirectivos.descargarCedulasDesempenio()}" 
                                                                     process="@this" icon="fa fa-download" styleClass="btn-primary"/>
                                                </f:facet>
                                            </p:toolbar>
                                        </div>
                                    </div>
                                    <div class="box box-body">
                                        <div class="row">
                                            <div class="col-sm-4" >
                                                <div class="ui-material">
                                                    <h:outputText value="Evaluaciones:" class=" hidden-sm hidden-xs"/>
                                                    <p:selectOneMenu value="#{administracionDirectivos.rol.evSelect}" id="evaluacion" required="true">
                                                        <f:selectItem itemLabel="Elija una evaluacion: " itemValue="#{null}" />
                                                        <f:selectItems value="#{administracionDirectivos.obtenerEvaluaciones()}" var="tipo" 
                                                                       itemValue="#{tipo.value}" itemLabel="#{tipo.label}" itemDescription="#{tipo.description}"/>
                                                        <p:ajax  listener="#{administracionDirectivos.obtenerPeriodosEvaluacion()}" process="evaluacion" 
                                                                 update="@form"/>
                                                    </p:selectOneMenu>
                                                </div>
                                            </div>
                                            <div class="col-sm-4" >
                                                <div class="ui-material">
                                                    <h:outputText value="Periodo de la evaluación:" class=" hidden-sm hidden-xs"/>
                                                    <p:selectOneMenu id="periodoEv" value="#{administracionDirectivos.rol.peSelect}"  autoWidth="true" effect="fade">
                                                        <f:selectItem itemLabel="Elija un periodo: " itemValue="#{null}" />
                                                        <f:selectItems value="#{administracionDirectivos.rol.listaEvaluaciones}" 
                                                                       var="periodo" itemValue="#{periodo.evaluacion}" itemLabel="#{periodo.evaluacion} - #{caster.clavePeriodoToString(periodo.periodo)}" 
                                                                       itemDescription="#{periodo.tipo}"/>
                                                        <p:ajax  process="@this" update="@form" listener="#{administracionDirectivos.generarResultados()}"/>
                                                    </p:selectOneMenu>
                                                </div>
                                            </div>
                                        </div>
                                        <p:separator/>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <p:dataTable var="persona" value="#{administracionDirectivos.rol.dtoListaEv360}" 
                                                             rendered="#{administracionDirectivos.rol.renderDTB360}"
                                                             paginator="true" rows="10"
                                                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} 
                                                             {NextPageLink} {LastPageLink}"
                                                             rowsPerPageTemplate="5,10,15" id="tblResEv360" lazy="true" paginatorPosition="top">
                                                    <f:facet name="footer">
                                                        Total de registros: #{administracionDirectivos.rol.dtoListaEv360.size()}
                                                    </f:facet>
                                                    <p:column headerText="Clave" width="50" style="font-size: small; border: 0">
                                                        <h:outputText value="#{persona.clave}" />
                                                    </p:column>
                                                    <p:column headerText="Nombre" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{persona.nombre}" />
                                                    </p:column>
                                                    <p:column headerText="Área" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{persona.areaOperativa}" />
                                                    </p:column>
                                                    <p:column headerText="Puesto" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{persona.categoriaOperativa}" />
                                                    </p:column>
                                                    <p:column headerText="Promedio de la evaluación" width="150" style="font-size: small; border: 0">
                                                        <div class="progress">
                                                            <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar"
                                                                 aria-valuenow="#{persona.promedio * 25}" aria-valuemin="0" aria-valuemax="100"
                                                                 style="background-color: #00a65a; width:#{persona.promedio * 25}%">
                                                                <h:outputText value="#{persona.promedio}" style="color: #0E0000; font-weight: bold">
                                                                    <f:convertNumber type="number" groupingUsed="true" minFractionDigits="6" pattern="#0.000000"/>
                                                                </h:outputText> 
                                                                <h:outputText value=" de 4.0" style="color: #0E0000; font-weight: bold"/>
                                                            </div>
                                                        </div>
                                                    </p:column>
                                                </p:dataTable>
                                                <p:dataTable var="desempenio" value="#{administracionDirectivos.rol.dtoListaEvDes}" 
                                                             rendered="#{administracionDirectivos.rol.renderDTBDesempenio}"
                                                             paginator="true" rows="10"
                                                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} 
                                                             {NextPageLink} {LastPageLink}"
                                                             rowsPerPageTemplate="5,10,15" id="tblResEvDes" lazy="true" paginatorPosition="top">
                                                    <f:facet name="footer">
                                                        Total de registros: #{administracionEvaluacionesPersonal.rol.dtoListaEvDes.size()}
                                                    </f:facet>
                                                    <p:column headerText="Clave" width="50" style="font-size: small; border: 0">
                                                        <h:outputText value="#{desempenio.clave}" />
                                                    </p:column>
                                                    <p:column headerText="Nombre" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{desempenio.nombre}" />
                                                    </p:column>
                                                    <p:column headerText="Área" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{desempenio.areaOperativa}" />
                                                    </p:column>
                                                    <p:column headerText="Puesto" width="150" style="font-size: small; border: 0">
                                                        <h:outputText value="#{desempenio.categoriaOperativa}" />
                                                    </p:column>
                                                    <p:column headerText="Promedio de la evaluación" width="150" style="font-size: small; border: 0">
                                                        <div class="progress">
                                                            <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar"
                                                                 aria-valuenow="#{desempenio.promedio * 20}" aria-valuemin="0" aria-valuemax="100"
                                                                 style="background-color: #00a65a; width:#{desempenio.promedio * 20}%">
                                                                <h:outputText value="#{desempenio.promedio}" style="color: #0E0000; font-weight: bold">
                                                                    <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="#0.00"/>
                                                                </h:outputText> 
                                                                <h:outputText value=" de 5.0" style="color: #0E0000; font-weight: bold"/>
                                                            </div>
                                                        </div>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </h:form>
                    </c:if>
                </div>
            </c:if>
        </section>

    </ui:define>
</ui:composition>
